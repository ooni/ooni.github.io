<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content='initial-scale=1,width=device-width'><title>Measuring SNI based blocking in Iran | OONI</title>
<link rel=canonical href=https://ooni.org/post/2020-iran-sni-blocking/><meta name=description content="We evaluate our new SNI blocking experiment in Iran."><meta property="og:title" content="Measuring SNI based blocking in Iran"><meta property="og:description" content="We evaluate our new SNI blocking experiment in Iran."><meta property="og:type" content="article"><meta property="og:url" content="https://ooni.github.io/post/2020-iran-sni-blocking/"><meta property="og:image" content="https://ooni.github.io/post/2020-iran-sni-blocking/images/sniblocking.png"><meta property="article:published_time" content="2020-04-28T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-28T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ooni.github.io/post/2020-iran-sni-blocking/images/sniblocking.png"><meta name=twitter:title content="Measuring SNI based blocking in Iran"><meta name=twitter:description content="We evaluate our new SNI blocking experiment in Iran.">
  
    
    
      
        
          <link rel="stylesheet" href="/css/tailwind.a5508cc14beae77ec99966635604bf68e64fb5e2bacc574e4f35b01978b55a58.css" integrity="sha256-pVCMwUvq537JmWZjVgS/aOZPteK6zFdOTzWwGXi1Wlg=" crossorigin="anonymous">
        
      
    
  

<link rel=icon type=image/png href=/images/favicon-96x96.png sizes=96x96><link rel=icon type=image/svg+xml href=/images/favicon.svg><link rel="shortcut icon" href=/images/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><script type=text/javascript src=https://cdn.jsdelivr.net/npm/ooni-run/dist/widgets.js defer></script><script defer src=https://eu.umami.is/script.js data-website-id=6c8fa418-795c-41cc-9840-40c43a88648a domains=ooni.org,ooni.github.io,ooni.netlify.com,openobservatory.github.io></script></head><body><nav class="bg-ooniblue shadow"><div class=container><div class="flex h-16 justify-between"><div class=flex><div class="flex flex-shrink-0 items-center"><a href=/><img src=/images/logos/ooni-horizontal.svg alt="Open Observatory of Network Interference (OONI) Logo" class="h-8 w-auto"></a></div><div class="hidden lg:ml-6 lg:flex lg:space-x-8"><a href=/about/ class="inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-white hover:border-white hover:text-gray2">About
</a><a href=/nettest/ class="inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-white hover:border-white hover:text-gray2">Tests
</a><a href=/data/ class="inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-white hover:border-white hover:text-gray2">Data
</a><a href=/get-involved/ class="inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-white hover:border-white hover:text-gray2">Get Involved
</a><a href=/reports/ class="inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-white hover:border-white hover:text-gray2">Reports
</a><a href=/blog/ class="inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-white hover:border-white hover:text-gray2">Blog
</a><a href=/donate/ class="inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-white hover:border-white hover:text-gray2">Donate</a></div></div><div class="hidden lg:ml-6 lg:flex lg:items-center"><a href=/install/ class="rounded-md bg-transparent px-3.5 py-2.5 text-sm font-semibold text-white hover:text-ooniblue shadow-sm ring-2 ring-inset ring-white hover:bg-white">Install OONI Probe</a></div><div class="mr-2 flex items-center lg:hidden"><button type=button class="relative inline-flex items-center justify-center rounded-md p-2 text-gray4 hover:bg-gray1 hover:text-gray5 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo5" aria-controls=mobile-menu id=mobile-menu-btn aria-expanded=false>
<span class="absolute -inset-0.5"></span>
<span class=sr-only>Open main menu</span><svg class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg><svg class="hidden h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/></svg></button></div></div></div><div class="lg:hidden hidden" id=mobile-menu><div class="space-y-1 pb-3 pt-2"><a href=/about/ class="block border-l-4 border-transparent py-2 pl-3 pr-4 text-base font-medium border-transparent text-white hover:border-white hover:text-gray2">About
</a><a href=/nettest/ class="block border-l-4 border-transparent py-2 pl-3 pr-4 text-base font-medium border-transparent text-white hover:border-white hover:text-gray2">Tests
</a><a href=/data/ class="block border-l-4 border-transparent py-2 pl-3 pr-4 text-base font-medium border-transparent text-white hover:border-white hover:text-gray2">Data
</a><a href=/get-involved/ class="block border-l-4 border-transparent py-2 pl-3 pr-4 text-base font-medium border-transparent text-white hover:border-white hover:text-gray2">Get Involved
</a><a href=/reports/ class="block border-l-4 border-transparent py-2 pl-3 pr-4 text-base font-medium border-transparent text-white hover:border-white hover:text-gray2">Reports
</a><a href=/blog/ class="block border-l-4 border-transparent py-2 pl-3 pr-4 text-base font-medium border-transparent text-white hover:border-white hover:text-gray2">Blog
</a><a href=/donate/ class="block border-l-4 border-transparent py-2 pl-3 pr-4 text-base font-medium border-transparent text-white hover:border-white hover:text-gray2">Donate</a></div></div></nav><script type=text/javascript>var navbar=document.querySelector("#mobile-menu"),menuBtn=document.querySelector("#mobile-menu-btn"),menuBtnIconList=document.querySelectorAll("#mobile-menu-btn svg");menuBtn.addEventListener("click",function(){console.log("Got click"),console.log(navbar),navbar.classList.toggle("hidden"),menuBtnIconList.forEach(function(e){e.classList.toggle("hidden")})})</script><div class="container mt-6 post-container"><main class=font-serif><h1 class=article-title>Measuring SNI based blocking in Iran</h1><div class=byline><span class=author>Simone Basso</span>
<span class=date>2020-04-28</span></div><p>In this blog post we start evaluating <a href=https://github.com/ooni/spec/blob/adf9537c43ef848b96792f8dea99fbd7f93fe608/nettests/ts-024-sni-blocking.md>OONI&rsquo;s new SNI blocking
experiment</a>.
To this end, we will use measurements performed in Iran, where the
blocking technique measured by this experiment is deployed.</p><p>OONI&rsquo;s SNI blocking experiment discovers cases where <a href=https://tls.ulfheim.net/>a Client Hello
packet</a> carrying a specific SNI
triggers blocking. In this context, SNI means <a href=https://en.wikipedia.org/wiki/Server_Name_Indication>Server Name
Indication</a>.
It is an extension to the <a href=https://en.wikipedia.org/wiki/Transport_Layer_Security>Transport Layer
Security</a>
(TLS) protocol that allows a client to specify the domain name that it
wants an HTTP server to serve. This extension is used in many TLS use
cases. For example, when you access
<a href=https://www.google.com>https://www.google.com</a> with your
browser, the code will send a Client Hello packet containing the string
<code>www.google.com</code> in the SNI extension.</p><p>The SNI blocking experiment works as illustrated by the following
diagram:</p><p><img alt="SNI blocking experiment" src=/post/2020-iran-sni-blocking/images/sniblocking.png></p><p>The experiment uses a test helper; in this example
<a href=https://ipinfo.io/93.184.216.34>93.184.216.34</a>. As of
24th April 2020, this is the IP address of a web server serving, among
others, the <a href=http://www.example.com>www.example.com</a>
website. We start the first TLS handshake sending a Client Hello
containing the <code>www.example.com</code> SNI. Since
<a href=http://www.example.com>www.example.com</a> is typically not
blocked in most countries, and because the test helper serves such a
domain, we expect the first handshake to nearly always
succeed.</p><p>The second TLS handshake instead is for an SNI that (1) we think could
be blocked and (2) is not served by <code>93.184.216.34</code>. We therefore expect
this second handshake to fail with the server telling us that it cannot
serve <a href=http://www.blocked.com>www.blocked.com</a>. However,
if the network between the Probe and the test helper implements a rule
saying &ldquo;no matter what, block any TLSHello where the SNI extension
contains <a href=https://www.blocked.com>www.blocked.com</a>&rdquo;, then the TLS handshake will instead
fail.</p><p>If we cannot perform the first TLS handshake, the experiment is
inconclusive. Otherwise, the result of the second TLS handshake tells us
whether there was network interference. For more information on the
algorithm used, please refer to <a href=https://github.com/ooni/spec/blob/adf9537c43ef848b96792f8dea99fbd7f93fe608/nettests/ts-024-sni-blocking.md>the specification of our SNI
experiment</a>.</p><p>To evaluate this methodology, we ran experiments in Iran because we
know that Iran implements SNI based blocking. We tested 112 domains for
signs of SNI based blocking across three different autonomous systems:</p><ol><li><p><a href=https://ipinfo.io/AS12880>AS12880</a> (Information
Technology Company), henceforth indicated as DCI;</p></li><li><p><a href=https://ipinfo.io/AS58224>AS58224</a> (Iran
Telecommunication Company PJS), henceforth TCI;</p></li><li><p><a href=https://ipinfo.io/AS197207>AS197207</a> (Mobile
Communication Company of Iran, PLC), henceforth MCI.</p></li></ol><p>Since the results of the SNI blocking experiment are not exposed through
<a href=https://explorer.ooni.org/>OONI Explorer</a> yet, <a href=https://gist.github.com/bassosimone/ad8eb608b42135dcae287de5d62f8551>we also published the scripts
to download and process the measurements</a>.</p><p>The following table shows all the domains (and hence SNIs) for which
we noticed signs of network interference for at least one of the three
tested ASNs:</p><table><thead><tr><th>DOMAIN</th><th>AS12880 (DCI)</th><th>AS58224 (TCI)</th><th>AS197207 (MCI)</th></tr></thead><tbody><tr><td>9gag.com</td><td></td><td>timeout</td><td></td></tr><tr><td>d1vq87e9lcf771.cloudfront.net</td><td>timeout</td><td>timeout</td><td>reset</td></tr><tr><td>d3kwyfyztuo0xs.cloudfront.net</td><td>timeout</td><td></td><td>got_server_hello</td></tr><tr><td>i.pinimg.com</td><td>got_server_hello</td><td></td><td>reset</td></tr><tr><td>ifacetimeapp.com</td><td></td><td>timeout</td><td></td></tr><tr><td>instinctmagazine.com</td><td></td><td>timeout</td><td></td></tr><tr><td>isaalmasih.net</td><td></td><td>timeout</td><td></td></tr><tr><td>log.quora.com</td><td></td><td></td><td>reset</td></tr><tr><td>openvpn.net</td><td></td><td>timeout</td><td></td></tr><tr><td>pridesource.com</td><td></td><td>timeout</td><td></td></tr><tr><td>psiphon.ca</td><td></td><td>timeout</td><td></td></tr><tr><td>twitpic.com</td><td></td><td>timeout</td><td></td></tr><tr><td><a href=https://www.eurogrand.com>www.eurogrand.com</a></td><td></td><td>timeout</td><td></td></tr><tr><td><a href=https://www.jdate.com>www.jdate.com</a></td><td></td><td>timeout</td><td></td></tr><tr><td><a href=https://www.monife.com>www.monife.com</a></td><td></td><td>timeout</td><td></td></tr><tr><td><a href=https://www.partypoker.net>www.partypoker.net</a></td><td></td><td>timeout</td><td></td></tr><tr><td><a href=https://www.pinkcupid.com>www.pinkcupid.com</a></td><td></td><td>timeout</td><td></td></tr><tr><td><a href=https://www.quora.com>www.quora.com</a></td><td>got_server_hello</td><td></td><td>reset</td></tr><tr><td><a href=https://www.scruff.com>www.scruff.com</a></td><td></td><td>timeout</td><td></td></tr><tr><td><a href=https://www.ucc.org>www.ucc.org</a></td><td></td><td>timeout</td><td></td></tr><tr><td><a href=https://www.vice.com>www.vice.com</a></td><td></td><td>timeout</td><td></td></tr><tr><td><a href=https://www.vonage.com>www.vonage.com</a></td><td></td><td>timeout</td><td></td></tr><tr><td><a href=https://www.xroxy.com>www.xroxy.com</a></td><td></td><td>timeout</td><td></td></tr><tr><td>xhamster.com</td><td></td><td>timeout</td><td></td></tr></tbody></table><p>An empty cell indicates that there is no measurement for a
specific network; <code>timeout</code> indicates that the TLS handshake timed out;
<code>reset</code> means that the handshake was interrupted by a reset; and
<code>got_server_hello</code> means that we received the Server Hello as expected
(i.e. there was no interference).</p><p>We observe that connections are reset on the MCI network, while we
only observe timeout anomalies on the other two tested ASNs. We also
observe that in some cases there is interference in some networks and
no blocking in other networks.</p><p>To further understand the nature of the interference, we discuss two specific
measurements. We start with a measurement blocked with RST, whose JSON
has of course been trimmed to increase clarity and
readability.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JavaScript data-lang=JavaScript><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;test_keys&#34;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;target&#34;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;sni&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;d1vq87e9lcf771.cloudfront.net&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;network_events&#34;</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;proto&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;tcp&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;dial_id&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;conn_id&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;failure&#34;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;t&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.312834468</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;address&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;93.184.216.34:443&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;operation&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;connect&#34;</span>                    <span style=color:#75715e>// (1)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;proto&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;tcp&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;num_bytes&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>281</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;conn_id&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;failure&#34;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;t&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.31307321</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;operation&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;write&#34;</span>                      <span style=color:#75715e>// (2)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;failure&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;connection_reset&#34;</span>,            <span style=color:#75715e>// (3)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#e6db74>&#34;operation&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;read&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;proto&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;tcp&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;t&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.431875659</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;conn_id&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;th_address&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;example.com:443&#34;</span>               <span style=color:#75715e>// (4)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;probe_asn&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;AS197207&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;resolver_network_name&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Cloudflare, Inc.&#34;</span>,      <span style=color:#75715e>// (5)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#e6db74>&#34;report_id&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20200411T155627Z_AS197207_VlF35wOyEbESrCD4T0c8KpiKdsexqrdMwH5cqkL9OYLLY3040f&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We can see from this measurement that the connection is reset after we
have successfully established the connection (1), and we have written
the 281 bytes of the Client Hello (2). The reset, in particular, is
received when we&rsquo;re reading the response to the Hello (3). The test
helper we are using is example.com:443 (4), and the IP address we&rsquo;re
connecting to has been resolved using Cloudflare DNS over HTTPS resolver
(5).</p><p>Also, the following experiment performed on 24th April 2020, clearly shows
that the IP address is valid for example.com:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>% curl -svo/dev/null --connect-to example.com:443:93.184.216.34:443 https://example.com
</span></span><span style=display:flex><span>* Connecting to hostname: 93.184.216.34
</span></span><span style=display:flex><span>[...]
</span></span><span style=display:flex><span>* Server certificate:
</span></span><span style=display:flex><span>*  subject: C=US; ST=California; L=Los Angeles; O=Internet Corporation for Assigned Names and Numbers; OU=Technology; CN=www.example.org
</span></span><span style=display:flex><span>*  start date: Nov 28 00:00:00 2018 GMT
</span></span><span style=display:flex><span>*  expire date: Dec  2 12:00:00 2020 GMT
</span></span><span style=display:flex><span>*  subjectAltName: host &#34;example.com&#34; matched cert&#39;s &#34;example.com&#34;
</span></span><span style=display:flex><span>*  issuer: C=US; O=DigiCert Inc; CN=DigiCert SHA2 Secure Server CA
</span></span><span style=display:flex><span>*  SSL certificate verify ok.
</span></span><span style=display:flex><span>* Using HTTP2, server supports multi-use
</span></span></code></pre></div><p>In fact, &ldquo;SSL certificate verify ok&rdquo; means that curl has successfully
connected to the specified address and successfully negotiated a TLS
connection for the given domain name. Also, the &ldquo;--connect-to&rdquo; option
ensures that we bypass the DNS and use 93.184.216.34
directly.</p><p>Let us now discuss a measurement where we see a timeout
anomaly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JavaScript data-lang=JavaScript><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;test_keys&#34;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;target&#34;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;sni&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;psiphon.ca&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;network_events&#34;</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;proto&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;tcp&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;dial_id&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>15</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;conn_id&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>13</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;failure&#34;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;t&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.254239264</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;address&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;93.184.216.34:443&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;operation&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;connect&#34;</span>                   <span style=color:#75715e>// (1)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;proto&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;tcp&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;num_bytes&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>262</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;conn_id&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>13</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;failure&#34;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;t&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.254566734</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;operation&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;write&#34;</span>                     <span style=color:#75715e>// (2)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;failure&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;unknown_failure: [...] use of closed network connection&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;operation&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;read&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;proto&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;tcp&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;t&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10.264251304</span>,                       <span style=color:#75715e>// (4)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#e6db74>&#34;conn_id&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>13</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;th_address&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;example.com:443&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;tls_handshakes&#34;</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;tls_version&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;conn_id&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;peer_certificates&#34;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;cipher_suite&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;failure&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;generic_timeout_error&#34;</span>,     <span style=color:#75715e>// (3)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#e6db74>&#34;negotiated_protocol&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;t&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10.264170017</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;probe_asn&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;AS58224&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;resolver_network_name&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Cloudflare, Inc.&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;report_id&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20200418T105440Z_AS58224_GguWqwSThCto4VAEZRXIvcYMK7QILkHt9LFAed09mTBLM2LsgX&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>What we see happening here is that we can successfully connect to the
test helper (1), and we can successfully write the Client Hello (2).
However, the TLS handshake process terminates with timeout after ten
seconds (3). A few microseconds after that, the read operation that was
waiting for the response to the Client Hello also terminates with an
error (4). The IP address that we&rsquo;re connecting to is legitimate, since
it&rsquo;s exactly the same as what we validated before.</p><p>Similar patterns are observed for the other measurements, but we omit
the results from this discussion for brevity. The presence of the
<code>tls_handshakes</code> array for all the measurements presented here, which is
also not shown for brevity, indicates that all the measurements reached
the phase in which the TLS Handshake was being performed. That is, we
know that the interference happened <em>during</em> the handshake, not before
it.</p><p>We therefore conclude that our SNI blocking experiment works as
intended in a scenario where SNI based blocking is implemented. Blocking
is detected when connecting to a test helper that is unrelated with the
SNI we want to measure. Different ASNs implement blocking differently:
the mobile AS197207 autonomous system resets the connection; AS12880 and
AS58224 likely discard packets, causing the TLS handshake process to
timeout. We have strong evidence that the interference occurred when the
code was performing the TLS handshake.</p></main></div><footer class=bg-blue9 aria-labelledby=footer-heading><h2 id=footer-heading class=sr-only>Footer</h2><div class="mx-auto px-6 pb-8 pt-16 lg:px-8"><div class="xl:grid xl:grid-cols-3 xl:gap-8"><div class=space-y-8><img src=/images/logos/ooni-horizontal.svg class=h-7 alt="OONI Logo"><p class="text-sm leading-6 text-gray3">Global community measuring internet censorship around the
world.</p><div class="flex space-x-6"><a href=https://twitter.com/OpenObservatory class="text-gray5 hover:text-gray4"><span class=sr-only>Twitter</span>
<svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.29 20.251c7.547.0 11.675-6.253 11.675-11.675.0-.178.0-.355-.012-.53A8.348 8.348.0 0022 5.92a8.19 8.19.0 01-2.357.646 4.118 4.118.0 001.804-2.27 8.224 8.224.0 01-2.605.996 4.107 4.107.0 00-6.993 3.743A11.65 11.65.0 013.392 4.748a4.106 4.106.0 001.27 5.477A4.072 4.072.0 012.8 9.713v.052a4.105 4.105.0 003.292 4.022 4.095 4.095.0 01-1.853.07 4.108 4.108.0 003.834 2.85A8.233 8.233.0 012 18.407a11.616 11.616.0 006.29 1.84"/></svg>
</a><a rel=me class="text-gray5 hover:text-gray4" href=https://mastodon.social/@ooni><span class=sr-only>Mastodon</span>
<svg class="h-6 w-6" viewBox="0 0 232 248" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M165.107 188.625c31.008-3.702 58.006-22.808 61.4-40.265 5.346-27.5 4.905-67.1093 4.905-67.1093.0-53.6854-35.173-69.4214-35.173-69.4214C178.504 3.684 148.051.258667 116.412.0H115.635C83.9962.258667 53.5628 3.684 35.8268 11.8293c0 0-35.174653 15.736-35.174653 69.4214C.652147 84.5053.635326 87.9285.617814 91.4921.56918 101.389.515222 112.37.801481 123.831 2.07881 176.332 10.4268 228.075 58.9682 240.923 81.3495 246.847 100.565 248.087 116.041 247.236 144.107 245.68 159.861 237.22 159.861 237.22L158.936 216.857S138.88 223.181 116.356 222.411C94.0402 221.645 70.4815 220.004 66.8722 192.605 66.5388 190.199 66.3722 187.625 66.3722 184.923 66.3722 184.923 88.2788 190.277 116.041 191.549 133.018 192.328 148.937 190.555 165.107 188.625zm24.816-38.205V85.4155C189.923 72.1302 186.54 61.5728 179.747 53.7622 172.739 45.9515 163.563 41.9475 152.174 41.9475c-13.18.0-23.16 5.0653-29.758 15.1973L116 67.8982l-6.414-10.7534c-6.599-10.132-16.5791-15.1973-29.7578-15.1973C68.4375 41.9475 59.2615 45.9515 52.2549 53.7622c-6.7947 7.8106-10.1774 18.368-10.1774 31.6533V150.42H67.8309V87.3262c0-13.3 5.5959-20.0507 16.7893-20.0507C96.9962 67.2755 103.2 75.2835 103.2 91.1182V125.653h25.602V91.1182c0-15.8347 6.202-23.8427 18.578-23.8427C158.574 67.2755 164.17 74.0262 164.17 87.3262V150.42h25.753z"/></svg>
</a><a rel=me class="text-gray5 hover:text-gray4" href=https://bsky.app/profile/ooni.org><span class=sr-only>Bluesky</span>
<svg class="h-6 w-6" viewBox="0 0 24 24" fill="currentcolor"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565.139 1.908.0 3.08.0 3.768c0 .69.378 5.65.624 6.479.815 2.736 3.713 3.66 6.383 3.364.136-.02.275-.039.415-.056-.138.022-.276.04-.415.056-3.912.58-7.387 2.005-2.83 7.078 5.013 5.19 6.87-1.113 7.823-4.308.953 3.195 2.05 9.271 7.733 4.308 4.267-4.308 1.172-6.498-2.74-7.078a8.741 8.741.0 01-.415-.056c.14.017.279.036.415.056 2.67.297 5.568-.628 6.383-3.364.246-.828.624-5.79.624-6.478.0-.69-.139-1.861-.902-2.206-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8z" stroke-width="1"/></svg>
</a><a href=https://facebook.com/ooni.org class="text-gray5 hover:text-gray4"><span class=sr-only>Facebook</span>
<svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094.0 2.238.195 2.238.195v2.46h-1.26c-1.243.0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd"/></svg>
</a><a href=https://www.instagram.com/openobservatory/ class="text-gray5 hover:text-gray4"><span class=sr-only>Instagram</span>
<svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12.315 2c2.43.0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902.0 011.772 1.153 4.902 4.902.0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902.0 01-1.153 1.772 4.902 4.902.0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643.0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902.0 01-1.772-1.153A4.902 4.902.0 012.525 18.55c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902.0 011.153-1.772A4.902 4.902.0 015.45 2.525c.636-.247 1.363-.416 2.427-.465C8.901 2.013 9.256 2 11.685 2h.63zm-.081 1.802h-.468c-2.456.0-2.784.011-3.807.058-.975.045-1.504.207-1.857.344-.467.182-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.047 1.023-.058 1.351-.058 3.807v.468c0 2.456.011 2.784.058 3.807.045.975.207 1.504.344 1.857.182.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.048 1.37.058 4.041.058h.08c2.597.0 2.917-.01 3.96-.058.976-.045 1.505-.207 1.858-.344.466-.182.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.048-1.055.058-1.37.058-4.041v-.08c0-2.597-.01-2.917-.058-3.96-.045-.976-.207-1.505-.344-1.858a3.097 3.097.0 00-.748-1.15 3.098 3.098.0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.023-.047-1.351-.058-3.807-.058zM12 6.865a5.135 5.135.0 110 10.27 5.135 5.135.0 010-10.27zm0 1.802a3.333 3.333.0 100 6.666 3.333 3.333.0 000-6.666zm5.338-3.205a1.2 1.2.0 110 2.4 1.2 1.2.0 010-2.4z" clip-rule="evenodd"/></svg>
</a><a href=https://www.youtube.com/c/OONIorg class="text-gray5 hover:text-gray4"><span class=sr-only>YouTube</span>
<svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M19.812 5.418c.861.23 1.538.907 1.768 1.768C21.998 8.746 22 12 22 12s0 3.255-.418 4.814a2.504 2.504.0 01-1.768 1.768c-1.56.419-7.814.419-7.814.419s-6.255.0-7.814-.419a2.505 2.505.0 01-1.768-1.768C2 15.255 2 12 2 12s0-3.255.417-4.814a2.507 2.507.0 011.768-1.768C5.744 5 11.998 5 11.998 5s6.255.0 7.814.418zM15.194 12 10 15V9l5.194 3z" clip-rule="evenodd"/></svg>
</a><a href=https://github.com/ooni class="text-gray5 hover:text-gray4"><span class=sr-only>GitHub</span><svg class="h-6 w-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483.0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951.0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65.0.0.84-.27 2.75 1.026A9.564 9.564.0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688.0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855.0 1.338-.012 2.419-.012 2.747.0.268.18.58.688.482A10.019 10.019.0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/></svg></a></div></div><div class="mt-16 grid grid-cols-3 gap-8 xl:col-span-2 xl:mt-0 [&_li]:my-2 [&_ul]:space-y-4 [&_ul]:my-2"><div><h3 class="text-sm font-semibold leading-6 text-white">About</h3><ul role=list><li><a href=/about class="text-sm leading-6 text-gray3 hover:text-white">About OONI</a></li><li><a href=/partners class="text-sm leading-6 text-gray3 hover:text-white">OONI
Partners</a></li><li><a href=/about/data-policy class="text-sm leading-6 text-gray3 hover:text-white">Data
Policy</a></li><li><a href=/about/privacy-policy class="text-sm leading-6 text-gray3 hover:text-white">Privacy Policy</a></li><li><a href=https://github.com/ooni/license/tree/master/data class="text-sm leading-6 text-gray3 hover:text-white">Data License</a></li><li><a href=https://ooni.org/about/#contact class="text-sm leading-6 text-gray3 hover:text-white">Contact</a></li></ul></div><div><h3 class="text-sm font-semibold leading-6 text-white">OONI Probe</h3><ul role=list><li><a href=/install/ class="text-sm leading-6 text-gray3 hover:text-white">Install</a></li><li><a href=/nettest/ class="text-sm leading-6 text-gray3 hover:text-white">Tests</a></li><li><a href=https://github.com/ooni/ class="text-sm leading-6 text-gray3 hover:text-white">Source Code</a></li><li><a href=https://api.ooni.io/ class="text-sm leading-6 text-gray3 hover:text-white">API</a></li></ul></div><div><h3 class="text-sm font-semibold leading-6 text-white">Updates</h3><ul role=list><li><a href=/post class="text-sm leading-6 text-gray3 hover:text-white">Blog</a></li><li><a href=https://lists.torproject.org/cgi-bin/mailman/listinfo/ooni-talk class="text-sm leading-6 text-gray3 hover:text-white">Mailing List</a></li><li><a href=https://slack.ooni.org/ class="text-sm leading-6 text-gray3 hover:text-white">Slack</a></li></ul></div></div></div><div class="mt-16 border-t border-white/10 pt-8 sm:mt-20 lg:mt-24"><p class="text-xs leading-5 text-gray4">&copy; 2025 Open Observatory of Network Interference
(OONI).
<a href=https://github.com/ooni/license>Content available under a Creative Commons license.</a></p></div></div></footer></body></html>